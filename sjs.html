<html>
<head>
    <title>Self Javascript Playground</title>

<script src="s.js"></script>

<style>
    * {
        font-face:monospace;
        font-size:104%;
        margin:0;
        background-color:black;
        color:white;
        border: solid black 1pcx
    }
    button {
        font-size:100%;
        color: white;
    }
    b, textarea {
        background-color: white;
        color: black;
    }
    div {
        font-face:monospace;
        background-color: white;
        color: black;
        width: 56em;
        //height: 24em;
        border: 1px solid #ccc;
}
</style>

</head>
<body>

<!--<button type="button" onclick="load()">Load</button> -->
<button type="button" onclick="execute()">Execute</button>
<button type="button" onclick="parse()">Parse</button>
<button type="button" onclick="compile()">Compile</button>
<button type="button" onclick="run()">Run</button>
<input type="file" accept="js" onchange="load(this)">
<br>
<textarea contenteditable="true" id="textarea" rows="24" cols="80" ondrop="alert('TODO')" autofocus>
//  Ti prego, scrivi qualcosa di sensato...

let x = "alert(x)";
alert(x);
</textarea>
<br>
<span style="font-size:small">&copy; 2024 by Paolo Caressa</span>

<script>

let token_list = null;
let run_time = null;

function parse() {
    token_list = sjs_scan(document.getElementsByTagName("textarea").textarea.value);
    console.log(token_list);
    if (false) {
        let w = window.open("/", "Token List");
        w.document.write("<h1>Token List</h1><table>");
        for (let i = 0; i < token_list.length; ++ i) {
            w.document.write("<tr><td><b>" + token_list[i].s + "</b></td><td>" + token_list[i].t + "</td></tr>");
        }
        w.document.write("</table>");
    }
}

function compile() {
    if (token_list == null) {
        alert("Compile requires Parse");
    } else {
        run_time = sjs_compile(token_list);
        console.log(run_time);
    }
}

function run() {
    if (run_time == null) {
        alert("Run requires Compile");
    } else {
        sjs_run(run_time);
    }
}

function execute() {
    parse();
    compile();
    run();
}

function load(input) {
    let file = input.files[0];
    let reader = new FileReader();
    reader.onload = function() {
        document.getElementsByTagName("textarea").textarea.value = reader.result;
        //console.log(reader.result);
    };
    reader.onerror = function() {
        alert(reader.error);
    };
    reader.readAsText(file);
}

</script>

</body>
</html>
