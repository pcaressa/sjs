<!DOCTYPE html>
<html>
<head>
    <title>Self JavaScript Playground</title>

<script src="s.js"></script>

<style>
    * {
        font-family:monospace;
        font-size:104%;
        margin:0;
        background-color:black;
        color:#0F0;
        border: black solid 1px;
    }
    button, input, label {
        font-size:100%;
        color: #0F0;
        border: white solid 1px;
        padding-block: 1px;
        padding-inline: 6px;
    }
    b, textarea {
        font-family:monospace;
        background-color: #222;
        color: #0F0;
        border: white solid 1px;
    }
    div {
        font-face:monospace;
        background-color: white;
        color: black;
        width: 56em;
        //height: 24em;
        border: #ccc solid 1px;
    }
    table, tr, th, td {
        border: 1px solid black;
    }
}
</style>

</head>
<body>

<!--<button type="button" onclick="load()">Load</button> -->
<input type="file" onchange="load(this)" id="files" style="display:none"/><label for="files">Load</label>
<button type="button" onclick="execute(false)">Run</button>
<button type="button" onclick="execute(true)">Debug</button>
<button type="button" onclick="parse()">Parse</button>
<button type="button" onclick="compile()">Compile</button>
<br>
<textarea contenteditable="true" id="textarea" rows="24" cols="80" ondrop="alert('TODO')" autofocus>

let f = function(x) {
  return function(y) {
    return x + y;
  };
};
let s10 = f(10);
let s20 = f(20);
alert(s10(30));
alert(s20(30));

/*
let i = 0, j = 0;
while (i < 10) {
  while (j < 10){
    console.log("(" + i, "," + j + ")");
    ++ j;
  }
  ++ i;
}
*/
//~ let x = "alert(x)";
//~ alert(x);
//~ let a = [1,2,3], b = {a:1,b:2,c:3};
//~ console.log(a);
//~ let x = {a: "alpha", b:{a:1,b:null}, c: 0.001};
//~ console.log(x);
//~ x.b.b = 10;
//~ ++ x.c;
//~ console.log(x);
//~ alert(1 && 0);
//~ alert(1 || 0);
//~ alert(0 && 1);
//~ alert(0 || 1);
//~ alert(function(x) { return x + 1; });
function(x) { return x + 1; }(10);
</textarea>
<br>
<span style="font-size:small">&copy; 2024 by Paolo Caressa</span>

<script>

let token_list = null;
let run_time = {debug: false};

function compile() {
    if (token_list == null) {
        alert("Compile requires Parse");
    } else {
        run_time = sjs_compile_block(token_list);
        console.log(run_time);
        let w = window.open("/", "Compiled Code");
        w.document.write("<h1>Compiled Code</h1><table>");
        for (let i = 0; i < run_time.code.length; ++ i) {
            w.document.write("<code>[" + i + "] ");
            if (run_time.code[i] && run_time.code[i].$name) {
                w.document.write(run_time.code[i].$name);
            } else {
                w.document.write(sjs_object2string(run_time.code[i]));
            }
            w.document.write("</code></br>");
}}}

function execute(debug) {
    console.log("Debug: " + debug);
    token_list = sjs_scan(document.getElementsByTagName("textarea").textarea.value);
    run_time = sjs_compile_block(token_list);
    sjs_run(run_time, debug);
}

function load(input) {
    let file = input.files[0];
    let reader = new FileReader();
    reader.onload = function() {
        document.getElementsByTagName("textarea").textarea.value = reader.result;
    };
    reader.onerror = function() {
        alert(reader.error);
    };
    reader.readAsText(file);
}

function parse() {
    token_list = sjs_scan(document.getElementsByTagName("textarea").textarea.value);
    console.log(token_list);
    let w = window.open("/", "Token List");
    w.document.write("<h1>Token List</h1><table>");
    w.document.write("<tr><th> # </th><td><b style='font-family:courier new'> Token </b></td><td> Type </td><td> line:column</td></tr>");
    for (let i = 0; i < token_list.length; ++ i) {
        w.document.write("<tr><td>" + i + "</td><td><b style='font-family:courier new'>" + token_list[i].s + "</b></td><td>" + token_list[i].t + "</td><td>" + token_list[i].l + ":" + token_list[i].c + "</td></tr>");
    }
    w.document.write("</table>");
}

</script>

</body>
</html>
